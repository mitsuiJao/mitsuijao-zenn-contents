---
title: "Herokuã§Websocketã‚’èµ·å‹•ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹(H10)"
emoji: "ğŸš¨"
type: "tech"
topics:
  - "heroku"
  - "nodejs"
  - "error"
  - "websocket"
  - "express"
published: true
published_at: "2024-11-06 01:36"
---

node.jsã®expressã€websocketã‚’ä½¿ç”¨ã—ãŸwebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¾ã—ãŸã€‚Herokuã«ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/1c76ea5e0e28-20241106.png)

ã‚¢ãƒ—ãƒªå´ã«å•é¡ŒãŒã‚ã‚‹ã‚‰ã—ãã€ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ãƒ­ã‚°ã‚’ç¢ºèªã—ã¾ã™ã€‚

## H10ã‚¨ãƒ©ãƒ¼
```
2024-11-02T14:26:28.809913+00:00 heroku[router]: at=error code=H10 desc="App crashed" method=GET path="/" host=~ request_id=~ fwd="~" dyno= connect= service= status=503 bytes= protocol=https
2024-11-02T14:26:29.390331+00:00 heroku[router]: at=error code=H10 desc="App crashed" method=GET path="/favicon.ico" host=~ request_id=~ fwd="~" dyno= connect= service= status=503 bytes= protocol=https
```
ã®ã‚¨ãƒ©ãƒ¼ãŒç¢ºèªã§ãã¾ã—ãŸã€‚ã‚„ã¯ã‚Šã‚¢ãƒ—ãƒªã®ã‚¨ãƒ©ãƒ¼ã‚‰ã—ã„ã§ã™ã€‚

appã‚’å†èµ·å‹•ã—ã¾ã—ãŸã€‚
```
$ heroku restart
```
æ²»ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

:::details ä½™è«‡
### npm error Missing script: "start"
```
2024-11-02T13:47:02.638814+00:00 heroku[web.1]: Starting process with command `npm start`
2024-11-02T13:47:03.394003+00:00 app[web.1]: npm error Missing script: "start"
```
ã¾ãšã¯ã“ã‚Œã§ã™ã€‚ãã‚‚ãã‚‚ã‚¹ã‚¿ãƒ¼ãƒˆã‚³ãƒãƒ³ãƒ‰ãŒé•ã„ã¾ã—ãŸã€‚

ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`Procfile`ã‚’ä½œæˆã—ã€`web: node index.js`ã‚’æ›¸ãã¾ã™ã€‚
appãŒèµ·å‹•ã—ãŸéš›ã«ã“ã®ã‚³ãƒãƒ³ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã¯expressãŒè¨˜è¿°ã—ã¦ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚

https://devcenter.heroku.com/ja/articles/nodejs-support#default-web-process-type

package.jsonã®scripts.startã‚ˆã‚ŠProcfileã®ã»ã†ãŒå„ªå…ˆã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

`Procfile`ã‚’ä½œæˆã—ãªãã¦ã‚‚ã€`package.json`ã«
```
"scripts": {
  "start": "node server.js"
}
```
ã‚’è¨˜è¿°ã™ã‚‹ã ã‘ã§å¤§ä¸ˆå¤«ãã†ã§ã™ã€‚

ä½™è«‡ã§ã™ãŒã€Overviewã®Dyno formationã«ã‚¹ã‚¿ãƒ¼ãƒˆã‚³ãƒãƒ³ãƒ‰ãŒè¨˜è¼‰ã—ã¦ã‚ã‚‹ã®ã§ç¢ºèªã§ãã¾ã™
![](https://storage.googleapis.com/zenn-user-upload/b5751637b58f-20241106.png)
:::

### Error: Cannot find module 'express'
ä¾ç„¶ã¨ã—ã¦H10ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚ã‚„ã¯ã‚Šã“ã“ã§ã—ã‚‡ã†ã‹
```
2024-11-03T16:31:36.195855+00:00 app[web.1]: Error: Cannot find module 'express'
```

ã“ã®çŠ¶æ…‹ã ã¨appãŒèµ·å‹•ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ã¾ã™ã€‚package.jsonã®dependednciesãŒã‚ˆããªã„ã‚‰ã—ã„ã§ã™ã€‚
```js:before
"dependencies": {
    "http-server": "^14.1.1",
    "express": "^4.17.1",
    "ws": "^8.2.3"
},
"devDependencies": {
    "express": "^4.19.2",
    "fs": "^0.0.1-security",
    "http": "^0.0.1-security",
    "ws": "^8.17.0"
}
```
ã‚ã¾ã‚Šç®¡ç†ã—ã¦ã„ãªã‹ã£ãŸã®ã§ãã¡ã‚ƒãã¡ã‚ƒã«ãªã£ã¦ã¾ã™ã€‚
devDependenciesã«æ›¸ã„ã¦ã‚ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯æœ¬ç•ªç’°å¢ƒã§ã¯å‰Šé™¤ã•ã‚Œã‚‹ä»•æ§˜ã‚‰ã—ã„ã§ã™ãŒã€ãã‚ŒãŒé–¢ä¿‚ã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã­ã€‚ã€‚ï¼Ÿãã‚Œã‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç³»ã‹ãªï¼Ÿã£ã¦æ„Ÿã˜ã§ã™ã€‚
`http-server`ã¯éå»ã«è©¦ã—ãŸã ã‘ã®ã‚„ã¤ãªã®ã§ç¾çŠ¶ä½¿ã£ã¦ã„ã¾ã›ã‚“ã€‚

```js:after
"dependencies": {
    "express": "*",
    "body-parser": "*",
    "ws": "*"
}
```
ã“ã‚Œã ã‘ã«ã—ã¾ã—ãŸã€‚

## ç„¡äº‹èµ·å‹•
```
2024-11-05T15:22:03.000000+00:00 app[api]: Build succeeded
2024-11-05T15:22:03.509260+00:00 app[web.1]: listen for 29000
```
èµ·å‹•ã—ã¾ã—ãŸã€‚è‰¯ã‹ã£ãŸã§ã™ãª

## å‚è€ƒ
https://stackoverflow.com/questions/36112119/heroku-deployment-with-express-js-is-not-happening