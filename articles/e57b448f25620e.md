---
title: "OpenCVã§ç”»åƒã‚’AAé¢¨ã«ã—ã¦ã¿ãŸ"
emoji: "ğŸ"
type: "tech"
topics:
  - "python"
  - "opencv"
  - "pillow"
published: true
published_at: "2024-08-03 03:51"
---

## ã“ã‚“ã«ã¡ã¯
mitsuiJaoã§ã™
Pythonã§AAé¢¨ã«ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œã‚Šã¾ã—ãŸã€‚èª°ã‹ã«è¦‹ã›ãŸã„ã¨ã‹ã˜ã‚ƒãªã„ã‘ã©è‡ªåˆ†ãŒç”ŸããŸè¨¼ã¨ã—ã¦ã“ã®è¨˜äº‹ã‚’æ®‹ã—ã¾ã™ğŸŒŸ
![](https://storage.googleapis.com/zenn-user-upload/7296c5082ecd-20240802.png =400x)
*å®Ÿè¡Œçµæœã€€ï¼ˆé ç›®ã‹ã‚‰è¦‹ãŸã»ã†ãŒã„ã„ã‚ˆï¼‰*

ä»Šå›AAã‚’ä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã¯ã€å‹‰å¼·ã®æ„ã‚’å«ã‚ä»–ã®æ–¹ã®ã‚³ãƒ¼ãƒ‰ã¯ç›´æ¥ä½¿ç”¨ã—ã¦ãªã„ã§ã™ã€‚ï¼ˆã‚‚ã¡ã‚ã‚“ã€ãƒ‘ãƒ¼ãƒ„äº‹ã«ã¯å‚è€ƒã«ã—ã¦ã„ã¾ã™ãŒï¼‰

## æ¦‚è¦
ç”»åƒã¾ãŸã¯å‹•ç”»ã‚’å…¥åŠ›ã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ–‡å­—åˆ—ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚OpenCVã§ã®ç°¡å˜ãªå®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ã®ã§ã‚³ãƒ¼ãƒ‰ã‚‚å˜ç´”ãªã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚

Gitã«ã‚‚[ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/mitsuiJao/AA)ã‚ã‚Šã¾ã™ãã‚ˆ

ã‚½ãƒ¼ã‚¹ã¯ã„ã£ã¡ã‚ƒã‚“æœ€å¾Œã«è²¼ã£ã¨ãã¾ã™

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
```
opencv-python       4.7.0.68
numpy               1.24.1
Pillow              9.4.0
```
pillowã¯`noudo.py`ã®ã¿ä½¿ç”¨ã—ã¦ã¾ã™

### ãƒ•ã‚¡ã‚¤ãƒ«
```
AA
â”œ aa.py
â”” main.py
```

ã“ã‚Œã¨ã¯åˆ¥ã«`main.py`ã§ä½¿ã†æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«`nouo.py`ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã®ã«`noudo.py`ã¯å¿…è¦ã§ã¯ãªã„ã®ã§åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯å¿…è¦ãªã„ã§ã™ã€‚

## ä¸­èº«
AAé¢¨ã®ç”»åƒã‚’ä½œã‚‹ã«ã‚ãŸã£ã¦ã€AAã§è¡¨ç¤ºã•ã›ã‚‹æ–‡å­—ã‚’æ±ºå®šã—ãªã‘ã‚Œã°ã„ã‘ã¾ã›ã‚“ã€‚å…·ä½“çš„ã«ã¯å˜ä½æ–‡å­—å½“ãŸã‚Šã®ç·šã®æ¿ƒåº¦ã€è¨€ã„æ›ãˆã‚‹ã¨ãã®æ–‡å­—ãŒã©ã®ç¨‹åº¦é»’ã„ã‹ã‚’é †ç•ªã«ä¸¦ã¹ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### noudo.py
å®Ÿè¡Œã™ã‚‹ã¨
```
['`', '.', "'", '-', ':', ',', '"', '_', '^', '~', '<', ';', '>', '!', '*', '=', '/', '\\', '+', 'L', 'r', '|', '?', 'c', ')', '(', '7', 'v', 'T', '{', 'z', 'J', ']', 's', 'i', 'x', 'Y', '}', '1', 'f', 'F', 'l', 'n', 'C', 'u', 't', 'I', '3', 'o', '2', '5', '[', 'E', 'P', 'j', 'K', 'S', 'y', 'V', 'Z', 'h', 'e', 'a', 'k', 'X', 'U', 'w', '4', 'p', 'b', '9', 'A', 'H', '6', 'm', 'D', 'd', 'G', 'O', 'q', 'R', '#', 'B', 'W', '8', '$', 'N', '%', 'M', '0', 'Q', '&', 'g', '@'] 94
```
ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚ç¢ºã‹ã«æ–‡å­—ãŒã ã‚“ã ã‚“é»’ããªã£ã¦ã¾ã™ã­ï½

1. Pillowã§1æ–‡å­—ã®ç”»åƒã‚’ç”Ÿæˆ
2. ãã®ç”»åƒã‚’cv2ã«å¤‰æ›
3. ã‚°ãƒ¬ã‚¤ã‚¹ã‚±ãƒ¼ãƒ«åŒ–
4. é»’ã®ãƒ‰ãƒƒãƒˆãŒå«ã¾ã‚Œã‚‹æ•°ã‚’numpyã§ã‚«ã‚¦ãƒ³ãƒˆ

ã‚ˆãè€ƒãˆãŸã‚‰cv2ã«å¤‰æ›ã—ãªãã¦ã‚‚ã§ãã‚‹ã‹ãªãƒ¼ã£ã¦æ€ã„ã¾ã—ãŸã€‚


OpenCVã§ã‚‚åŒæ§˜ãªå‡¦ç†ã¯ã§ããŸã®ã§ã™ãŒã€ã©ã†ã‚‚ã‚«ã‚¹ã¿ãŸã„ãªãƒ•ã‚©ãƒ³ãƒˆã—ã‹ä½¿ãˆãªã„ã‚‰ã—ã„ã®ã§ã€ãƒ•ã‚©ãƒ³ãƒˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚Œã°ãã®ãƒ•ã‚©ãƒ³ãƒˆãŒä½¿ãˆã‚‹ã¨ã„ã†Pillowã‚’ä½¿ã„ã¾ã—ãŸã€‚

ä»Šå›ã¯Windowsæ¨™æº–ã®`consola.ttf`ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚Windowsæ¨™æº–ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§å‡ºåŠ›ã™ã‚‹ã®ã§ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ•ã‚©ãƒ³ãƒˆä½¿ã†ãŒè³¢æ˜ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚åƒ•ã¯ç‰¹ã«èª¿ã¹ãªã‹ã£ãŸã§ã™ã€‚

ï¼ˆèª¿ã¹ãŸã‚‰OpenCVã§å¤–éƒ¨ã®ãƒ•ã‚©ãƒ³ãƒˆã€ä½¿ãˆã‚‹ã‚ˆã†ã§ã™ï¼‰
https://qiita.com/hon_no_mushi/items/b139df3dcf6559404b3f

![](https://storage.googleapis.com/zenn-user-upload/ebe378e45c9d-20240802.png)
*ãªã«ã“ã‚Œç¬‘æ•™ç§‘æ›¸ãƒ•ã‚©ãƒ³ãƒˆã‹ã‚ˆç¬‘*


### aa.py
AAé¢¨ã®æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹`draw()`é–¢æ•°ãŒå…¥ã£ã¦ã¾ã™ã€‚å…¥åŠ›ã¯OpenCVã§èª­ã¿è¾¼ã¾ã‚ŒãŸndarrayå‹ã€è¿”ã‚Šå€¤ã¯strå‹ã§ã™ã€‚
ã•ã£ãã®`noudo.py`ã§å‡ºåŠ›ã•ã‚ŒãŸå†…å®¹ã‚’ãã®ã¾ã¾ã‚³ãƒ”ãƒšã—ã¦`asset`ã¨ã—ã¦ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦ã¾ã™ã€‚æ¯å›å‡¦ç†ã™ã‚‹å¿…è¦ãªã„ã®ã§å¦¥å½“ã§ã™ï¼ˆè¿«çœŸï¼‰


ã¾ãŸpngãªã©RGBãƒãƒ£ãƒãƒ«ä»¥å¤–ã«é€æ˜ãƒãƒ£ãƒãƒ«ãŒã‚ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã‚’(0, 0, 0)ã§åŸ‹ã‚ã€é»’ã§å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã§ã‚‚ã“ã‚Œã†ã¾ãã„ã£ãŸã‚Šã„ã‹ãªã‹ã£ãŸã‚Šã§ã™ã€‚


ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦

1. ç”»åƒã‚’ã‚°ãƒ¬ã‚¤ã‚¹ã‚±ãƒ¼ãƒ«åŒ–
2. yè»¸ã‚’0.5å€ã«ãƒªã‚µã‚¤ã‚ºï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã®æ–‡å­—ãŒç¸¦æ¨ªæ¯”2:1ã®ãŸã‚ï¼‰
3. xè»¸ãŒ`OOKISA`å®šæ•°ã«ãªã‚‹ã‚ˆã†ã«ãƒªã‚µã‚¤ã‚º
4. å„ãƒ”ã‚¯ã‚»ãƒ«ã‚’`asset`ã®è¦ç´ æ•°ã§å‰²ã‚‹ã€ã™ãªã‚ã¡255æ®µéšã®ã‚¯ãƒ¬ã‚¤ã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¦ç´ ã«å¯¾å¿œã™ã‚‹ã‚ˆã†ã«
5. é©å®œæ”¹è¡Œæ–‡å­—`\n`ã‚’å…¥ã‚ŒãªãŒã‚‰ã€å„ãƒ”ã‚¯ã‚»ãƒ«ã«å¯¾å¿œã—ãŸ`asset`ã‚’çµæœæ–‡å­—åˆ—ã«è¿½åŠ 

ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨å‡¦ç†ã¯å‰²ã¨å˜ç´”ã§ã€æ”¹ã‚ã¦ndarrayã®å‰å¤§ã•ã‚’æ„Ÿã˜ã¾ã™ãªã€‚

ã¾ãŸã€`asset`ã¯è‹±å¤§æ–‡å­—å°æ–‡å­—æ•°å­—è¨˜å·ã‚’ã™ã¹ã¦ä½¿ç”¨ã™ã‚‹ã¨94æ–‡å­—ã«ãªã‚Šã€å…¨ä½“ãŒç™½ããªã‚Šã™ãã‚‹ï¼Ÿæ°—ãŒã™ã‚‹ã®ã§æ•°ã‚’æ¸›ã‚‰ã—ãŸã‚‚ã®ã‚’ã„ãã¤ã‹ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚é©å®œä½¿ã„åˆ†ã‘ã‚‹ã¨ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚


ã‚ã¨ndaarayã®ã‚¹ãƒ©ã‚¤ã‚¹ï¼Ÿã¿ãŸã„ãªã‚„ã¤ã‚³ãƒ­ãƒ³ã ã‘ä½¿ã†ã‚„ã¤ãªã‚“ãªã‚“ã§ã™ã‹ã­ã€‚ã€‚ï¼Ÿ
`[:, :, 3]`ã®éƒ¨åˆ†ã€äºŒæ¬¡å…ƒã ã¨ç†è§£ã§ãã‚‹ã‚“ã§ã™ã‘ã©ã€ä¸‰æ¬¡å…ƒã«ãªã‚‹ã¨é€”ç«¯ã«æ„å‘³ã‚ã‹ã‚‰ãªããªã‚Šã¾ã™ã€‚


### main.py
`aa.py`ã‚’å‘¼ã³å‡ºã™å´ã§ã™ã€‚ä¸€å¿œèª­ã¿å–ã‚Šå¯ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦
å‹•ç”»ã¯"gif", "mp4", "avi", "mov", "wmv", "flv", "mkv", "webm", "m4v", "3gp", "3g2"
ç”»åƒã¯"jpg", "jpeg", "png", "bmp", "tiff"
ã®é…åˆ—ã‚’ä½¿ç”¨ã—ã¦ã¾ã™ãŒã€ã‚ãã¾ã§å‹•ç”»ã‹ç”»åƒã‹ã‚’åˆ¤å®šã—ã¦ã„ã‚‹ã¾ã§ã§ã™ã€‚

èª­ã¿è¾¼ã‚“ã ã‚‰ç”»åƒã¯ãã®ã¾ã¾`draw()`ã«æ¸¡ã—ã€å‹•ç”»ã®å ´åˆã¯1ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«`draw()`ã«æ¸¡ã—ã¦å‡ºåŠ›ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸå‹•ç”»ã®å ´åˆã€å‡ºåŠ›ã™ã‚‹ã”ã¨ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’`draw()`ã«å«ã¾ã‚ŒãŸ`\n`ã®æ•°ã‚«ãƒ¼ã‚½ãƒ«ã‚’ä¸Šã«æˆ»ã—ã¦ã„ã¾ã™ã€‚`print(AA+"\033["+str(row)+"A")`ã“ã®éƒ¨åˆ†ã§ã™ã­ã€‚å…·ä½“çš„ã«ã¯`"\033[nA"`ã‚’printã™ã‚‹ã¨nè¡Œåˆ†ã ã‘ã‚«ãƒ¼ã‚½ãƒ«ã‚’ä¸Šã«ç§»å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã“ã§ã¯AAã«å«ã¾ã‚Œã‚‹\nã®æ•°ãŒè©²å½“ã—ã¾ã™ã€‚
ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€é€£ç¶šã—ã¦ãƒãƒ¼ãƒãƒ¼å‡ºåŠ›ã•ã‚Œãšã«ä¸Šæ›¸ãã•ã‚Œã¦å‡ºåŠ›ã§ãã¾ã™ã€‚ä½•ã‚ˆã‚Šè¦‹ãŸç›®ãŒãã‚Œã„ã§è‰¯ãã§ã™ã€‚
"q"ã‹ctrl+cã‚’æŠ¼ã™ã¨çµ‚äº†ã§ãã¾ã™ã€‚


## çµæœ
ç”»åƒ
![](https://storage.googleapis.com/zenn-user-upload/b1c593fd5b6a-20240803.png =400x)
![](https://storage.googleapis.com/zenn-user-upload/8076e54d28af-20240803.png =400x)


å‹•ç”»ï¼ˆgifï¼‰
![](https://storage.googleapis.com/zenn-user-upload/341f1520b28d-20240803.gif =400x)
*By Janke - Own work, CC BY-SA 2.5, https://commons.wikimedia.org/w/index.php?curid=433430*
![](https://storage.googleapis.com/zenn-user-upload/732b87b331f8-20240803.gif =400x)


## ãŠã‚ã‚Š
ã¨ã¾ã‚ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚ã‚„ã£ã±ã‚ŠOpenCVã¯å‰å¤§ã§ã™ãªã€‚ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿å‹ã˜ã‚ƒãªãã¦ndarrayã§æ“ä½œã§ãã‚‹ã®ãŒä½•ã‚ˆã‚Šã¤ã‚ˆã¤ã‚ˆã§ã™ã€‚

ä»Šå›åˆã‚ã¦Zennã‚’ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚noteã¯ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãŒå¼±ã‹ã£ãŸã—ã€qiitaã¯ã‚ªãƒ¯ã‚³ãƒ³ã¿ãŸã„ãªã“ã¨è¨€ã‚ã‚Œã¦ãŸã®ã§Zennã‚’ä½¿ã„ã¾ã—ãŸã€‚
ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã§çµµæ–‡å­—ãŒä½¿ãˆã‚‹ã®ã¯Zennã—ã‹ãªã„ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã¨ã“ã ã—ç²‹ã§ã„ã„ã§ã™ã­ã€‚
UIã‚‚æ´—ç·´ã•ã‚Œã¦ã¦ã„ã„æ„Ÿã˜ã§ã™ã€‚ãŠã—ã‚ƒã‚“ãªã‹ãƒ•ã‚§*e*ã«æ¥ãŸã¿ãŸã„ã§ã™ã€‚

æ—¥è¨˜ã¿ãŸã„ã«ç·©ãæ›¸ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆå‹‰å¼·é ‘å¼µã‚ã†ã­ã€è‡ªåˆ†

èª­ã‚“ã§ã„ãŸã ããŸã„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚


## ã‚½ãƒ¼ã‚¹
```python:noudo.py
import numpy as np
from PIL import Image, ImageDraw, ImageFont
import cv2
import string
np.set_printoptions(linewidth=10000)
np.set_printoptions(threshold=np.inf)

def pil2cv(imgCV):
    ''' PILå‹ -> OpenCVå‹ '''
    new_image = np.array(imgCV, dtype=np.uint8)
    return new_image

def noudo(asset):
    img = Image.new("L", (30, 50), "black")
    draw = ImageDraw.Draw(img)
    font = ImageFont.truetype("consola.ttf", 50)
    draw.text((0, 0), asset, "white", font=font)
    cv2img = pil2cv(img)
    a, cv2img = cv2.threshold(cv2img, 100, 255, cv2.THRESH_BINARY)
    return np.count_nonzero(cv2img)

word = [i for i in string.ascii_lowercase+string.ascii_uppercase+string.digits+string.punctuation]
result = {}
for i in word:
    n = noudo(i)
    result[i] = n

sorted = sorted(result.items(), key=lambda x:x[1])
l = [i[0] for i in sorted]
print(l, len(l))
```

```python:aa.py
import cv2
import numpy as np
np.set_printoptions(linewidth=500)
np.set_printoptions(threshold=np.inf)
# aaset = ['`', '.', "'", '-', ':', ',', '"', '_', '^', '~', '<', ';', '>', '!', '*', '=', '/', '\\', '+', 'L', 'r', '|', '?', 'c', ')', '(', '7', 'v', 'T', '{', 'z', 'J', ']', 's', 'i', 'x', 'Y', '}', '1', 'f', 'F', 'l', 'n', 'C', 'u', 't', 'I', '3', 'o', '2', '5', '[', 'E', 'P', 'j', 'K', 'S', 'y', 'V', 'Z', 'h', 'e', 'a', 'k', 'X', 'U', 'w', '4', 'p', 'b', '9', 'A', 'H', '6', 'm', 'D', 'd', 'G', 'O', 'q', 'R', '#', 'B', 'W', '8', '$', 'N', '%', 'M', '0', 'Q', '&', 'g', '@']
# aaset = ['.', '-', ',', '_', '~', ';', '!', '=', '\\', 'L', '|', 'c', '(', 'v', '{', 'J', 's', 'x', '}', 'f', 'l', 'C', 't', '3', '2', '[', 'P', 'K', 'y', 'Z', 'e', 'k', 'U', '4', 'b', 'A', '6', 'D', 'G', 'q', '#', 'W', '$', '%', '0', '&', '@']
# aaset = ['.', ',', '~', '!', '\\', '|', '(', '{', 's', '}', 'l', 't', '2', 'P', 'y', 'e', 'U', 'b', '6', 'G', '#', '$', '0', '@']
aaset = ['.', '~', '\\', '(', 's', 'l', '2', 'y', 'U', '6', '#', '0']

OOKISA = 100
DETAIL = len(aaset) -1

def drow(img):
    if img.shape[2] == 4:
        alpha_channel = img[:, :, 3]
        mask = (alpha_channel == 0)
        # ãã®ãƒ”ã‚¯ã‚»ãƒ«ã®RGBãƒãƒ£ãƒãƒ«ã‚’0ã«è¨­å®šã™ã‚‹
        img[mask] = [0, 0, 0, 0]

    img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    img = cv2.resize(img, None, fx=1, fy=0.5)
    xyratio = img.shape[1] / OOKISA
    img = cv2.resize(img, (OOKISA, int(img.shape[0]/xyratio)))
    monoratio = 255 / DETAIL
    img = img / monoratio

    result = ""
    for i in range(img.shape[0]):
        for j in range(img.shape[1]):
            tmp = round(img[i][j])
            if img[i][j] == 0:
                result += " "
            else:
                result += aaset[tmp]
        result += "\n"

    return result
```

```python:main.py
import cv2
import sys
import aa
import os

path = "PATH"
ext = os.path.splitext(path)[1]
ext = ext[1:]
video = ["gif", "mp4", "avi", "mov", "wmv", "flv", "mkv", "webm", "m4v", "3gp", "3g2"]
image = ["jpg", "jpeg", "png", "bmp", "tiff"]

if ext in video:
    cap = cv2.VideoCapture(path)

    if not cap.isOpened():
        sys.exit()

    row = 0
    f = True
    while True:
        try:
            ret, frame = cap.read()
            if ret:
                cv2.imshow('image', frame)
                AA = aa.drow(frame)
                if f:
                    row = AA.count("\n")+1
                    f = False

                print(AA+"\033["+str(row)+"A")
                if cv2.waitKey(50) & 0xFF == ord('q'):
                    raise KeyboardInterrupt
            else:
                cap.set(cv2.CAP_PROP_POS_FRAMES, 0)

        except KeyboardInterrupt:
            # subprocess.run(["cls"], shell=True)
            print("\033["+str(row)+"B")
            print("quit")
            break
else:
    img = cv2.imread(path)
    AA = aa.drow(img)
    print(AA)

cv2.destroyAllWindows()
```